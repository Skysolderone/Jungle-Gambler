# æˆ˜æ–—ç³»ç»Ÿæ”¹è¿›æ–¹æ¡ˆ - å€Ÿé‰´ Balatro è®¾è®¡

> åŸºäº Balatro æ¸¸æˆæˆ˜æ–—ç³»ç»Ÿçš„æ·±åº¦åˆ†æ
> ç›®æ ‡ï¼šå°† Jungle Gambler çš„æˆ˜æ–—ç³»ç»Ÿå‡çº§ä¸ºæ›´æœ‰ç­–ç•¥æ€§å’Œè¶£å‘³æ€§çš„å›åˆåˆ¶å¡ç‰Œæˆ˜æ–—

---

## ç›®å½•

1. [å½“å‰ç³»ç»Ÿåˆ†æ](#1-å½“å‰ç³»ç»Ÿåˆ†æ)
2. [Balatro æ ¸å¿ƒè®¾è®¡å€Ÿé‰´](#2-balatro-æ ¸å¿ƒè®¾è®¡å€Ÿé‰´)
3. [æ”¹è¿›æ–¹æ¡ˆè®¾è®¡](#3-æ”¹è¿›æ–¹æ¡ˆè®¾è®¡)
4. [å®ç°è·¯çº¿å›¾](#4-å®ç°è·¯çº¿å›¾)
5. [ä»£ç æ¶æ„è®¾è®¡](#5-ä»£ç æ¶æ„è®¾è®¡)

---

## 1. å½“å‰ç³»ç»Ÿåˆ†æ

### 1.1 ç°æœ‰æˆ˜æ–—æµç¨‹

```
å½“å‰æµç¨‹ï¼š
å‡†å¤‡é˜¶æ®µ (10ç§’) â†’ é€‰æ‹©é­‚å°
    â†“
æˆ˜æ–—é˜¶æ®µ â†’ è‡ªåŠ¨å›åˆåˆ¶
    - æ·éª°å­ï¼ˆå…±ç”¨ï¼‰
    - è®¡ç®—åŠ›é‡ = åŸºç¡€åŠ›é‡ Ã— éª°å­ + é­‚å°åŠ æˆ
    - ä¼¤å®³ = abs(ç©å®¶åŠ›é‡ - æ•ŒäººåŠ›é‡)
    - é‡å¤ç›´åˆ°ä¸€æ–¹ HP å½’é›¶
    â†“
æˆ˜åˆ©å“é˜¶æ®µ â†’ èƒŒåŒ…æ»¡æ—¶é€‰æ‹©ä¸¢å¼ƒ
```

### 1.2 å½“å‰ç³»ç»Ÿçš„ä¼˜ç‚¹

âœ… **ç®€æ´ç›´è§‚** - è§„åˆ™ç®€å•æ˜“æ‡‚
âœ… **å¿«èŠ‚å¥** - æˆ˜æ–—è‡ªåŠ¨è¿›è¡Œ
âœ… **èµ„æºç®¡ç†** - é­‚å°æœ‰ä½¿ç”¨æ¬¡æ•°é™åˆ¶
âœ… **æˆ˜åˆ©å“ç³»ç»Ÿ** - èƒŒåŒ…æ»¡æ—¶éœ€è¦å–èˆ

### 1.3 å½“å‰ç³»ç»Ÿçš„é—®é¢˜

âŒ **ç¼ºä¹ç­–ç•¥æ·±åº¦** - ç©å®¶åªåœ¨å‡†å¤‡é˜¶æ®µåšå†³ç­–
âŒ **æˆ˜æ–—è¿‡ç¨‹å•è°ƒ** - æ— æ³•æ§åˆ¶æˆ˜æ–—æµç¨‹
âŒ **éšæœºæ€§è¿‡é«˜** - å®Œå…¨ä¾èµ–éª°å­è¿æ°”
âŒ **é­‚å°åŒè´¨åŒ–** - åªæœ‰æ•°å€¼å·®å¼‚ï¼Œæ— ç‰¹æ®Šæ•ˆæœ
âŒ **ç¼ºå°‘åé¦ˆ** - æˆ˜æ–—è¿‡ç¨‹ç¼ºå°‘è§†è§‰å’ŒéŸ³æ•ˆåé¦ˆ
âŒ **æ— æ³•ä¸­é€”è°ƒæ•´** - æˆ˜æ–—å¼€å§‹ååªèƒ½è§‚çœ‹

---

## 2. Balatro æ ¸å¿ƒè®¾è®¡å€Ÿé‰´

### 2.1 çŠ¶æ€æœºæ¶æ„

Balatro ä½¿ç”¨æ¸…æ™°çš„çŠ¶æ€æœºç®¡ç†æˆ˜æ–—æµç¨‹ï¼š

```
çŠ¶æ€æœºæ¨¡å¼ï¼š
SELECTING_HAND (é€‰ç‰Œ)
    â†“ ç©å®¶é€‰æ‹©å¡ç‰Œ
HAND_PLAYED (å‡ºç‰Œ)
    â†“ åŠ¨ç”»å’Œè®¡ç®—
ROUND_EVAL (è¯„ä¼°)
    â†“ æ£€æŸ¥èƒœåˆ©æ¡ä»¶
å›åˆ° SELECTING_HAND æˆ– ç»“æŸ
```

**å¯å€Ÿé‰´ç‚¹**ï¼š
- æ¯ä¸ªçŠ¶æ€èŒè´£å•ä¸€
- çŠ¶æ€ä¹‹é—´è½¬æ¢æ¸…æ™°
- ç©å®¶åœ¨æ¯å›åˆéƒ½æœ‰å†³ç­–ç©ºé—´

### 2.2 èµ„æºç®¡ç†ç³»ç»Ÿ

```gdscript
# Balatro çš„èµ„æºç®¡ç†
hands_left = 4        # å‡ºç‰Œæ¬¡æ•°
discards_left = 3     # å¼ƒç‰Œæ¬¡æ•°
target_chips = 600    # ç›®æ ‡åˆ†æ•°
```

**å¯å€Ÿé‰´ç‚¹**ï¼š
- å¤šç§èµ„æºç±»å‹å¢åŠ ç­–ç•¥æ·±åº¦
- å¼ƒç‰Œæœºåˆ¶å…è®¸ä¼˜åŒ–æ‰‹ç‰Œ
- æ˜ç¡®çš„èƒœåˆ©ç›®æ ‡

### 2.3 åˆ†å±‚è®¡ç®—ç³»ç»Ÿ

```
è®¡åˆ†å…¬å¼ï¼š
Base â†’ Enhancement â†’ Card Effects â†’ Hand Type â†’ Joker â†’ Blind â†’ Final

ä¾‹å¦‚ï¼š
10 chips Ã— 2 mult
+ Card Enhancement (+5 chips, +3 mult)
+ Joker Effects (Ã—1.5 mult)
+ Hand Modifiers (+20 chips, Ã—2 mult)
= æœ€ç»ˆåˆ†æ•°
```

**å¯å€Ÿé‰´ç‚¹**ï¼š
- å¤šå±‚ä¿®æ”¹å™¨å¯ä»¥æ— é™æ‰©å±•
- æ•ˆæœå åŠ é¡ºåºæ¸…æ™°
- æ˜“äºè°ƒè¯•å’Œå¹³è¡¡

### 2.4 CardArea ç³»ç»Ÿ

```gdscript
# å¡ç‰ŒåŒºåŸŸç®¡ç†
CardArea:
    - cards: Array[Card]          # å¡ç‰Œåˆ—è¡¨
    - highlighted: Array[Card]    # é€‰ä¸­çš„å¡ç‰Œ
    - highlighted_limit: int      # æœ€å¤šé€‰æ‹©æ•°é‡
    - align_cards()               # è‡ªåŠ¨å¸ƒå±€
```

**å¯å€Ÿé‰´ç‚¹**ï¼š
- è‡ªåŠ¨å¤„ç†å¡ç‰Œå¸ƒå±€å’Œé—´è·
- ç»Ÿä¸€çš„å¡ç‰Œå®¹å™¨ç®¡ç†
- é«˜äº®å’Œé€‰æ‹©çŠ¶æ€åˆ†ç¦»

### 2.5 äº‹ä»¶é©±åŠ¨åŠ¨ç”»

```gdscript
# Balatro çš„äº‹ä»¶ç³»ç»Ÿ
Event:ease(duration, target, ease_func)
Event:after(delay, callback)
Event:condition(check_func, callback)
```

**å¯å€Ÿé‰´ç‚¹**ï¼š
- å¼‚æ­¥åŠ¨ç”»ä¸é˜»å¡é€»è¾‘
- äº‹ä»¶é˜Ÿåˆ—ç®¡ç†å¤æ‚åºåˆ—
- æ˜“äºæ·»åŠ è§†è§‰åé¦ˆ

---

## 3. æ”¹è¿›æ–¹æ¡ˆè®¾è®¡

### 3.1 æ–°æˆ˜æ–—æµç¨‹è®¾è®¡

```
æ”¹è¿›åçš„æµç¨‹ï¼š

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  é˜¶æ®µ 1: å‡†å¤‡é˜¶æ®µ (PREPARATION)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
- æ—¶é—´é™åˆ¶ï¼š15 ç§’ï¼ˆå¢åŠ  5 ç§’ï¼‰
- ç©å®¶è¡ŒåŠ¨ï¼š
  âœ“ é€‰æ‹©é­‚å°ç»„åˆï¼ˆæœ€å¤š 5 ä¸ªï¼‰
  âœ“ æŸ¥çœ‹é­‚å°è¯¦æƒ…å’Œæ•ˆæœ
  âœ“ é…ç½®é­‚å°ä½¿ç”¨é¡ºåº
- æ•Œäººè¡ŒåŠ¨ï¼šæ˜¾ç¤ºæ•Œäººé­‚å°å’Œèƒ½åŠ›

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  é˜¶æ®µ 2: æˆ˜æ–—å›åˆ (COMBAT_ROUNDS)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ã€å›åˆå¼€å§‹ã€‘
  â†“
ã€ç©å®¶å›åˆã€‘(PLAYER_TURN)
  - å¯ç”¨æ¬¡æ•°ï¼š4 æ¬¡å‡ºæ‰‹ï¼ˆhandsï¼‰
  - æ¯æ¬¡å‡ºæ‰‹ï¼š
    1. é€‰æ‹©è¦ä½¿ç”¨çš„é­‚å°ï¼ˆ1-3 ä¸ªï¼‰
    2. æ·éª°å­
    3. è®¡ç®—ä¼¤å®³ = (åŸºç¡€åŠ›é‡ + é­‚å°åŠ›é‡æ€»å’Œ) Ã— éª°å­
    4. å¯¹æ•Œäººé€ æˆä¼¤å®³
  - å¼ƒç‰Œé€‰é¡¹ï¼š2 æ¬¡æœºä¼šï¼ˆdiscardsï¼‰
    * å¯ä»¥å¼ƒæ‰ä¸æƒ³ç”¨çš„é­‚å°
    * å¼ƒæ‰çš„é­‚å°ä¸æ¶ˆè€—ä½¿ç”¨æ¬¡æ•°
  â†“
ã€æ•Œäººå›åˆã€‘(ENEMY_TURN)
  - æ•Œäººè‡ªåŠ¨ä½¿ç”¨é­‚å°
  - è®¡ç®—å¹¶å¯¹ç©å®¶é€ æˆä¼¤å®³
  â†“
ã€å›åˆç»“æŸæ£€æŸ¥ã€‘
  - æ£€æŸ¥æ˜¯å¦æœ‰ä¸€æ–¹ HP å½’é›¶
  - å¦‚æœéƒ½å­˜æ´»ä¸”ç©å®¶è¿˜æœ‰å‡ºæ‰‹æ¬¡æ•° â†’ ä¸‹ä¸€å›åˆ
  - å¦‚æœå‡ºæ‰‹æ¬¡æ•°ç”¨å°½ä¸”æœªå‡»è´¥æ•Œäºº â†’ å¤±è´¥
  â†“
é‡å¤æˆ–ç»“æŸ

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  é˜¶æ®µ 3: æˆ˜åˆ©å“é˜¶æ®µ (LOOT)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
- ä¸ç°æœ‰ç³»ç»Ÿä¿æŒä¸€è‡´
- å¢åŠ æˆ˜åˆ©å“é¢„è§ˆåŠ¨ç”»
```

### 3.2 æ–°çŠ¶æ€æœºè®¾è®¡

```gdscript
enum BattleState {
    PREPARATION,        # å‡†å¤‡é˜¶æ®µ
    PLAYER_TURN,        # ç©å®¶å›åˆ
    PLAYER_SELECTING,   # ç©å®¶é€‰æ‹©é­‚å°
    PLAYER_ROLLING,     # ç©å®¶æ·éª°å­
    PLAYER_ATTACKING,   # ç©å®¶æ”»å‡»åŠ¨ç”»
    ENEMY_TURN,         # æ•Œäººå›åˆ
    ENEMY_ATTACKING,    # æ•Œäººæ”»å‡»åŠ¨ç”»
    ROUND_END,          # å›åˆç»“æŸ
    VICTORY,            # æˆ˜æ–—èƒœåˆ©
    DEFEAT,             # æˆ˜æ–—å¤±è´¥
    LOOT                # æˆ˜åˆ©å“
}
```

### 3.3 é­‚å°æ•ˆæœç³»ç»Ÿ

å¼•å…¥ Balatro é£æ ¼çš„æ•ˆæœå±‚ç³»ç»Ÿï¼š

```gdscript
# é­‚å°æ•ˆæœç±»å‹
enum SoulEffectType {
    POWER_FLAT,      # å›ºå®šåŠ›é‡åŠ æˆ +10
    POWER_MULT,      # åŠ›é‡å€æ•° Ã—1.5
    DICE_BONUS,      # éª°å­åŠ æˆ +2
    DICE_REROLL,     # é‡æ·éª°å­
    SHIELD,          # æ ¼æŒ¡ä¼¤å®³
    LIFE_STEAL,      # ç”Ÿå‘½å·å–
    COMBO_BONUS,     # è¿å‡»åŠ æˆ
    CRIT_CHANCE      # æš´å‡»å‡ ç‡
}

# é­‚å°å®šä¹‰ç¤ºä¾‹
{
    "id": "soul_thunder",
    "name": "é›·éœ†ä¹‹é­‚",
    "quality": 2,
    "power": 15,
    "effects": [
        {
            "type": POWER_FLAT,
            "value": 15
        },
        {
            "type": DICE_BONUS,
            "value": 1,
            "condition": "dice >= 4"  # éª°å­â‰¥4æ—¶ç”Ÿæ•ˆ
        }
    ]
}
```

### 3.4 UI å¸ƒå±€æ”¹è¿›

```
æ–°æˆ˜æ–—ç•Œé¢å¸ƒå±€ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [æˆ˜æ–—ä¿¡æ¯æ ]                                â”‚
â”‚  å›åˆ: 1  |  å‡ºæ‰‹æ¬¡æ•°: 3/4  |  å¼ƒç‰Œ: 2/2    â”‚
â”‚  ç›®æ ‡: å‡»è´¥æ•Œäºº  |  æ—¶é—´: 15s               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æ•Œäººä¿¡æ¯        â”‚  â”‚   ç©å®¶ä¿¡æ¯            â”‚
â”‚   HP: 80/100     â”‚  â”‚   HP: 90/100         â”‚
â”‚   åŠ›é‡: 30       â”‚  â”‚   åŠ›é‡: 50           â”‚
â”‚   [æ•Œäººé­‚å°åŒº]    â”‚  â”‚   é€‰ä¸­é­‚å°åŠ›é‡: +25   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         [æˆ˜æ–—åŠ¨ç”»åŒºåŸŸ]                       â”‚
â”‚         éª°å­ã€æ”»å‡»ç‰¹æ•ˆã€ä¼¤å®³æ•°å­—             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         [ç©å®¶é­‚å°æ‰‹ç‰ŒåŒº]                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”      â”‚
â”‚  â”‚é­‚å°â”‚ â”‚é­‚å°â”‚ â”‚é­‚å°â”‚ â”‚é­‚å°â”‚ â”‚é­‚å°â”‚      â”‚
â”‚  â”‚ 1  â”‚ â”‚ 2  â”‚ â”‚ 3  â”‚ â”‚ 4  â”‚ â”‚ 5  â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜      â”‚
â”‚  [ç‚¹å‡»é€‰æ‹©è¦ä½¿ç”¨çš„é­‚å°ï¼Œæœ€å¤š 3 ä¸ª]           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [æ“ä½œæŒ‰é’®åŒº]                                â”‚
â”‚  [å‡ºæ‰‹] [å¼ƒç‰Œ] [è·³è¿‡å›åˆ] [æŸ¥çœ‹è¯¦æƒ…]         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [æˆ˜æ–—æ—¥å¿—]                                  â”‚
â”‚  > ç©å®¶æ·å‡ºéª°å­: 5                           â”‚
â”‚  > ä½¿ç”¨é­‚å°: ç«ç„°ä¹‹é­‚ (+20)                  â”‚
â”‚  > æœ€ç»ˆåŠ›é‡: 50 + 20 = 70 Ã— 5 = 350        â”‚
â”‚  > å¯¹æ•Œäººé€ æˆ 350 ç‚¹ä¼¤å®³ï¼                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. å®ç°è·¯çº¿å›¾

### é˜¶æ®µ 1: æ ¸å¿ƒæ¶æ„é‡æ„ (ä¼˜å…ˆçº§: é«˜)

**ä»»åŠ¡**ï¼š
- [ ] åˆ›å»ºæ–°çš„çŠ¶æ€æœºç³»ç»Ÿ `BattleStateMachine.gd`
- [ ] å®ç°çŠ¶æ€è½¬æ¢ç®¡ç†å™¨
- [ ] åˆ›å»ºé­‚å°æ•ˆæœç³»ç»Ÿ `SoulEffect.gd`
- [ ] é‡æ„ UI å¸ƒå±€ä¸ºæ¨¡å—åŒ–ç»„ä»¶

**é¢„è®¡æ—¶é—´**ï¼š2-3 å°æ—¶

### é˜¶æ®µ 2: å›åˆåˆ¶ç³»ç»Ÿå®ç° (ä¼˜å…ˆçº§: é«˜)

**ä»»åŠ¡**ï¼š
- [ ] å®ç°ç©å®¶å›åˆé€»è¾‘ï¼ˆé€‰æ‹©ã€å‡ºæ‰‹ã€å¼ƒç‰Œï¼‰
- [ ] å®ç°æ•Œäºº AI å›åˆé€»è¾‘
- [ ] æ·»åŠ å‡ºæ‰‹æ¬¡æ•°å’Œå¼ƒç‰Œæ¬¡æ•°ç®¡ç†
- [ ] å®ç°å›åˆç»“æŸæ£€æŸ¥

**é¢„è®¡æ—¶é—´**ï¼š3-4 å°æ—¶

### é˜¶æ®µ 3: é­‚å°é€‰æ‹©å’Œæˆ˜æ–—åŠ¨ç”» (ä¼˜å…ˆçº§: ä¸­)

**ä»»åŠ¡**ï¼š
- [ ] å®ç°é­‚å°å¡ç‰‡é€‰æ‹©ç³»ç»Ÿï¼ˆç±»ä¼¼ Balatro çš„é«˜äº®ç³»ç»Ÿï¼‰
- [ ] æ·»åŠ éª°å­æ»šåŠ¨åŠ¨ç”»
- [ ] æ·»åŠ ä¼¤å®³æ•°å­—é£˜å‡ºåŠ¨ç”»
- [ ] æ·»åŠ é­‚å°æ¿€æ´»ç‰¹æ•ˆ

**é¢„è®¡æ—¶é—´**ï¼š2-3 å°æ—¶

### é˜¶æ®µ 4: é­‚å°æ•ˆæœç³»ç»Ÿ (ä¼˜å…ˆçº§: ä¸­)

**ä»»åŠ¡**ï¼š
- [ ] å®ç°å¤šç§é­‚å°æ•ˆæœç±»å‹
- [ ] æ·»åŠ æ•ˆæœè§¦å‘æ¡ä»¶ç³»ç»Ÿ
- [ ] å®ç°æ•ˆæœè®¡ç®—å™¨ï¼ˆåˆ†å±‚è®¡ç®—ï¼‰
- [ ] æ›´æ–°é­‚å°æ•°æ®åº“æ·»åŠ æ–°æ•ˆæœ

**é¢„è®¡æ—¶é—´**ï¼š3-4 å°æ—¶

### é˜¶æ®µ 5: éŸ³æ•ˆå’Œåé¦ˆä¼˜åŒ– (ä¼˜å…ˆçº§: ä½)

**ä»»åŠ¡**ï¼š
- [ ] æ·»åŠ æˆ˜æ–—éŸ³æ•ˆ
- [ ] æ·»åŠ  UI åé¦ˆéŸ³æ•ˆ
- [ ] ä¼˜åŒ–åŠ¨ç”»æµç•…åº¦
- [ ] æ·»åŠ å±å¹•éœ‡åŠ¨æ•ˆæœ

**é¢„è®¡æ—¶é—´**ï¼š1-2 å°æ—¶

---

## 5. ä»£ç æ¶æ„è®¾è®¡

### 5.1 æ–°æ–‡ä»¶ç»“æ„

```
scripts/
â”œâ”€â”€ battle/
â”‚   â”œâ”€â”€ BattleStateMachine.gd       # çŠ¶æ€æœºç®¡ç†
â”‚   â”œâ”€â”€ BattleState.gd              # çŠ¶æ€åŸºç±»
â”‚   â”œâ”€â”€ PreparationState.gd         # å‡†å¤‡é˜¶æ®µ
â”‚   â”œâ”€â”€ PlayerTurnState.gd          # ç©å®¶å›åˆ
â”‚   â”œâ”€â”€ EnemyTurnState.gd           # æ•Œäººå›åˆ
â”‚   â”œâ”€â”€ LootState.gd                # æˆ˜åˆ©å“é˜¶æ®µ
â”‚   â”œâ”€â”€ SoulEffect.gd               # é­‚å°æ•ˆæœç³»ç»Ÿ
â”‚   â”œâ”€â”€ DamageCalculator.gd         # ä¼¤å®³è®¡ç®—å™¨
â”‚   â””â”€â”€ BattleAnimator.gd           # æˆ˜æ–—åŠ¨ç”»ç®¡ç†
â”œâ”€â”€ Battle.gd                       # ä¸»æˆ˜æ–—åœºæ™¯ï¼ˆç®€åŒ–ï¼‰
â””â”€â”€ ...
```

### 5.2 æ ¸å¿ƒç±»è®¾è®¡

#### BattleStateMachine.gd

```gdscript
extends Node
class_name BattleStateMachine

signal state_changed(from_state, to_state)

var current_state: BattleState
var states: Dictionary = {}

func _ready():
    # æ³¨å†Œæ‰€æœ‰çŠ¶æ€
    register_state("preparation", PreparationState.new())
    register_state("player_turn", PlayerTurnState.new())
    register_state("enemy_turn", EnemyTurnState.new())
    register_state("loot", LootState.new())

func register_state(name: String, state: BattleState):
    states[name] = state
    state.state_machine = self

func change_state(state_name: String):
    if current_state:
        current_state.exit()

    var old_state = current_state
    current_state = states[state_name]
    current_state.enter()

    state_changed.emit(old_state, current_state)
```

#### BattleState.gd (æŠ½è±¡åŸºç±»)

```gdscript
extends Node
class_name BattleState

var state_machine: BattleStateMachine
var battle_scene: Node  # ä¸»æˆ˜æ–—åœºæ™¯å¼•ç”¨

func enter():
    # è¿›å…¥çŠ¶æ€æ—¶è°ƒç”¨
    pass

func exit():
    # é€€å‡ºçŠ¶æ€æ—¶è°ƒç”¨
    pass

func update(delta: float):
    # æ¯å¸§æ›´æ–°
    pass

func handle_input(event: InputEvent):
    # å¤„ç†è¾“å…¥
    pass
```

#### SoulEffect.gd

```gdscript
extends Resource
class_name SoulEffect

enum EffectType {
    POWER_FLAT,      # å›ºå®šåŠ›é‡ +X
    POWER_MULT,      # åŠ›é‡å€æ•° Ã—X
    DICE_BONUS,      # éª°å­åŠ æˆ +X
    DICE_REROLL,     # é‡æ·éª°å­
    SHIELD,          # æ ¼æŒ¡ä¼¤å®³
    LIFE_STEAL,      # ç”Ÿå‘½å·å– X%
    COMBO_BONUS,     # è¿å‡»åŠ æˆ
    CRIT_CHANCE      # æš´å‡»å‡ ç‡ X%
}

@export var type: EffectType
@export var value: float
@export var condition: String = ""  # è§¦å‘æ¡ä»¶ï¼ˆå¯é€‰ï¼‰

func can_apply(context: Dictionary) -> bool:
    """æ£€æŸ¥æ•ˆæœæ˜¯å¦å¯ä»¥åº”ç”¨"""
    if condition.is_empty():
        return true

    # ç®€å•æ¡ä»¶è§£æ
    # ä¾‹å¦‚: "dice >= 4", "hp < 50", "combo >= 3"
    return _evaluate_condition(condition, context)

func apply(context: Dictionary) -> Dictionary:
    """åº”ç”¨æ•ˆæœå¹¶è¿”å›ä¿®æ”¹åçš„ä¸Šä¸‹æ–‡"""
    match type:
        EffectType.POWER_FLAT:
            context["power"] += value
        EffectType.POWER_MULT:
            context["power"] *= value
        EffectType.DICE_BONUS:
            context["dice"] += value
        # ... å…¶ä»–æ•ˆæœ

    return context

func _evaluate_condition(condition_str: String, context: Dictionary) -> bool:
    # æ¡ä»¶è§£æé€»è¾‘
    # å¯ä»¥ä½¿ç”¨ç®€å•çš„å­—ç¬¦ä¸²è§£ææˆ–è¡¨è¾¾å¼æ±‚å€¼
    pass
```

#### DamageCalculator.gd

```gdscript
extends Node
class_name DamageCalculator

# å€Ÿé‰´ Balatro çš„åˆ†å±‚è®¡ç®—
func calculate_damage(base_power: int, dice: int, souls: Array, context: Dictionary) -> int:
    """
    åˆ†å±‚è®¡ç®—ä¼¤å®³ï¼š
    1. åŸºç¡€å±‚ï¼šåŸºç¡€åŠ›é‡ Ã— éª°å­
    2. é­‚å°å¹³å€¼å±‚ï¼šæ‰€æœ‰ POWER_FLAT æ•ˆæœ
    3. é­‚å°å€æ•°å±‚ï¼šæ‰€æœ‰ POWER_MULT æ•ˆæœ
    4. ç‰¹æ®Šæ•ˆæœå±‚ï¼šæš´å‡»ã€è¿å‡»ç­‰
    """

    var result = {
        "base_power": base_power,
        "dice": dice,
        "power": base_power,
        "multiplier": 1.0,
        "bonus": 0,
        "context": context
    }

    # é˜¶æ®µ 1: åº”ç”¨éª°å­åŠ æˆæ•ˆæœ
    for soul in souls:
        for effect in soul.effects:
            if effect.type == SoulEffect.EffectType.DICE_BONUS:
                if effect.can_apply(result):
                    result = effect.apply(result)

    # é˜¶æ®µ 2: åŸºç¡€è®¡ç®—
    result["power"] = result["base_power"] * result["dice"]

    # é˜¶æ®µ 3: åº”ç”¨å›ºå®šåŠ æˆ
    for soul in souls:
        for effect in soul.effects:
            if effect.type == SoulEffect.EffectType.POWER_FLAT:
                if effect.can_apply(result):
                    result = effect.apply(result)

    # é˜¶æ®µ 4: åº”ç”¨å€æ•°
    for soul in souls:
        for effect in soul.effects:
            if effect.type == SoulEffect.EffectType.POWER_MULT:
                if effect.can_apply(result):
                    result = effect.apply(result)

    # é˜¶æ®µ 5: ç‰¹æ®Šæ•ˆæœï¼ˆæš´å‡»ç­‰ï¼‰
    # ... æ›´å¤šç‰¹æ®Šæ•ˆæœ

    return int(result["power"])
```

#### PlayerTurnState.gd

```gdscript
extends BattleState
class_name PlayerTurnState

var selected_souls: Array = []
var hands_left: int = 4
var discards_left: int = 2

func enter():
    battle_scene.show_message("ä½ çš„å›åˆï¼")
    battle_scene.update_resources_display(hands_left, discards_left)
    battle_scene.enable_soul_selection(true)
    battle_scene.enable_action_buttons(true)

func exit():
    battle_scene.enable_soul_selection(false)
    battle_scene.enable_action_buttons(false)

func on_soul_selected(soul):
    if selected_souls.size() < 3:
        selected_souls.append(soul)
        battle_scene.highlight_soul(soul, true)

func on_soul_deselected(soul):
    selected_souls.erase(soul)
    battle_scene.highlight_soul(soul, false)

func on_play_button_pressed():
    if selected_souls.is_empty():
        battle_scene.show_message("è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªé­‚å°ï¼")
        return

    if hands_left <= 0:
        battle_scene.show_message("å‡ºæ‰‹æ¬¡æ•°å·²ç”¨å°½ï¼")
        return

    hands_left -= 1
    _execute_attack()

func on_discard_button_pressed():
    if selected_souls.is_empty():
        battle_scene.show_message("è¯·é€‰æ‹©è¦å¼ƒæ‰çš„é­‚å°ï¼")
        return

    if discards_left <= 0:
        battle_scene.show_message("å¼ƒç‰Œæ¬¡æ•°å·²ç”¨å°½ï¼")
        return

    discards_left -= 1
    # å¼ƒæ‰é€‰ä¸­çš„é­‚å°ï¼ˆä¸æ¶ˆè€—ä½¿ç”¨æ¬¡æ•°ï¼‰
    selected_souls.clear()
    battle_scene.show_message("å·²å¼ƒç‰Œ")

func _execute_attack():
    # æ’­æ”¾æ”»å‡»åŠ¨ç”»åºåˆ—
    await battle_scene.play_dice_animation()
    var dice = randi() % 6 + 1

    var damage = battle_scene.damage_calculator.calculate_damage(
        battle_scene.player_base_power,
        dice,
        selected_souls,
        {"attacker": "player"}
    )

    await battle_scene.play_attack_animation(damage)
    battle_scene.enemy_hp -= damage

    selected_souls.clear()
    battle_scene.update_display()

    # æ£€æŸ¥æˆ˜æ–—æ˜¯å¦ç»“æŸ
    if battle_scene.enemy_hp <= 0:
        state_machine.change_state("victory")
    elif hands_left <= 0:
        state_machine.change_state("enemy_turn")
```

---

## 6. å…³é”®æ”¹è¿›ç‚¹æ€»ç»“

### 6.1 å€Ÿé‰´ Balatro çš„è®¾è®¡ä¼˜åŠ¿

| è®¾è®¡å…ƒç´  | Balatro å®ç° | æˆ‘ä»¬çš„åº”ç”¨ |
|---------|-------------|-----------|
| **çŠ¶æ€æœº** | 19 ä¸ªæ¸…æ™°çŠ¶æ€ | 10 ä¸ªæˆ˜æ–—çŠ¶æ€ï¼ŒèŒè´£åˆ†ç¦» |
| **èµ„æºç®¡ç†** | hands/discards | å‡ºæ‰‹æ¬¡æ•°/å¼ƒç‰Œæ¬¡æ•° |
| **åˆ†å±‚è®¡ç®—** | 6 å±‚æ•ˆæœå åŠ  | 5 å±‚ä¼¤å®³è®¡ç®— |
| **CardArea** | è‡ªåŠ¨å¸ƒå±€ç®¡ç† | é­‚å°å¡ç‰‡åŒºåŸŸç®¡ç† |
| **äº‹ä»¶é©±åŠ¨** | Event ç³»ç»Ÿ | Godot Signal + Tween |

### 6.2 ä¿ç•™åŸæœ‰ç³»ç»Ÿçš„ä¼˜ç‚¹

âœ… **é­‚å°ä½¿ç”¨æ¬¡æ•°** - ä¿ç•™è€ä¹…åº¦æœºåˆ¶
âœ… **æˆ˜åˆ©å“é€‰æ‹©** - ä¿ç•™èƒŒåŒ…ç®¡ç†ç­–ç•¥
âœ… **å“è´¨ç³»ç»Ÿ** - ä¿ç•™é­‚å°å“è´¨åˆ†çº§
âœ… **ç®€æ´å¿«é€Ÿ** - ä¸è¿‡åº¦å¤æ‚åŒ–

### 6.3 æ–°å¢ç­–ç•¥æ·±åº¦

ğŸ¯ **å›åˆå†…å†³ç­–** - æ¯å›åˆé€‰æ‹©ä½¿ç”¨å“ªäº›é­‚å°
ğŸ¯ **èµ„æºç®¡ç†** - å¹³è¡¡å‡ºæ‰‹æ¬¡æ•°å’Œå¼ƒç‰Œæ¬¡æ•°
ğŸ¯ **é­‚å°ç»„åˆ** - ä¸åŒæ•ˆæœçš„ååŒä½œç”¨
ğŸ¯ **é£é™©æ§åˆ¶** - é€‰æ‹©ä¿å®ˆæˆ–æ¿€è¿›çš„ç­–ç•¥

---

## 7. å¼€å‘ä¼˜å…ˆçº§å»ºè®®

### ç¬¬ä¸€é˜¶æ®µï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰- å¿…é¡»å®ç°

1. **çŠ¶æ€æœºç³»ç»Ÿ** - æˆ˜æ–—æµç¨‹çš„åŸºç¡€
2. **å›åˆåˆ¶ç³»ç»Ÿ** - ç©å®¶å’Œæ•Œäººè½®æµè¡ŒåŠ¨
3. **é­‚å°é€‰æ‹© UI** - æ¸…æ™°çš„é€‰æ‹©åé¦ˆ
4. **åŸºç¡€åŠ¨ç”»** - éª°å­ã€ä¼¤å®³æ•°å­—

### ç¬¬äºŒé˜¶æ®µï¼ˆå¢å¼ºä½“éªŒï¼‰- æ¨èå®ç°

5. **é­‚å°æ•ˆæœç³»ç»Ÿ** - å¤šæ ·åŒ–çš„æ•ˆæœç±»å‹
6. **æˆ˜æ–—æ—¥å¿—ä¼˜åŒ–** - æ›´æ¸…æ™°çš„ä¿¡æ¯å±•ç¤º
7. **éŸ³æ•ˆåé¦ˆ** - æå‡æ‰“å‡»æ„Ÿ

### ç¬¬ä¸‰é˜¶æ®µï¼ˆé”¦ä¸Šæ·»èŠ±ï¼‰- å¯é€‰å®ç°

8. **ç‰¹æ•ˆåŠ¨ç”»** - åä¸½çš„è§†è§‰æ•ˆæœ
9. **æ•Œäºº AI å˜åŒ–** - ä¸åŒçš„è¡Œä¸ºæ¨¡å¼
10. **æˆ˜æ–—ç»Ÿè®¡** - ä¼¤å®³åˆ†æã€æ•ˆç‡è¯„åˆ†

---

## 8. å®ç°ç¤ºä¾‹ä»£ç ç‰‡æ®µ

### æ”¹è¿›åçš„ Battle.gd ä¸»åœºæ™¯

```gdscript
extends Control

# å­ç³»ç»Ÿ
var state_machine: BattleStateMachine
var damage_calculator: DamageCalculator
var battle_animator: BattleAnimator

# æˆ˜æ–—æ•°æ®
var player_hp: int = 100
var enemy_hp: int = 100
var player_base_power: int = 50
var enemy_base_power: int = 30

func _ready():
    # åˆå§‹åŒ–å­ç³»ç»Ÿ
    state_machine = BattleStateMachine.new()
    damage_calculator = DamageCalculator.new()
    battle_animator = BattleAnimator.new()

    add_child(state_machine)
    add_child(damage_calculator)
    add_child(battle_animator)

    # è®¾ç½®çŠ¶æ€æœº
    state_machine.battle_scene = self

    # åŠ è½½æˆ˜æ–—æ•°æ®
    _load_battle_data()

    # å¼€å§‹å‡†å¤‡é˜¶æ®µ
    state_machine.change_state("preparation")

func _process(delta):
    if state_machine.current_state:
        state_machine.current_state.update(delta)
```

---

## 9. æµ‹è¯•è®¡åˆ’

### å•å…ƒæµ‹è¯•

- [ ] çŠ¶æ€è½¬æ¢é€»è¾‘æµ‹è¯•
- [ ] ä¼¤å®³è®¡ç®—å…¬å¼æµ‹è¯•
- [ ] é­‚å°æ•ˆæœåº”ç”¨æµ‹è¯•
- [ ] èµ„æºç®¡ç†ï¼ˆæ¬¡æ•°ï¼‰æµ‹è¯•

### é›†æˆæµ‹è¯•

- [ ] å®Œæ•´æˆ˜æ–—æµç¨‹æµ‹è¯•
- [ ] å¤šç§é­‚å°ç»„åˆæµ‹è¯•
- [ ] è¾¹ç•Œæ¡ä»¶æµ‹è¯•ï¼ˆHP å½’é›¶ã€æ¬¡æ•°ç”¨å°½ç­‰ï¼‰

### ç©æ³•æµ‹è¯•

- [ ] ç­–ç•¥æ·±åº¦è¯„ä¼°
- [ ] éš¾åº¦å¹³è¡¡è°ƒæ•´
- [ ] ç”¨æˆ·ä½“éªŒåé¦ˆ

---

## 10. æ€»ç»“

é€šè¿‡å€Ÿé‰´ Balatro çš„ä¼˜ç§€è®¾è®¡ï¼Œæˆ‘ä»¬å¯ä»¥å°† Jungle Gambler çš„æˆ˜æ–—ç³»ç»Ÿå‡çº§ä¸ºï¼š

âœ¨ **æ›´æœ‰ç­–ç•¥æ€§** - ç©å®¶åœ¨æ¯å›åˆéƒ½éœ€è¦åšå†³ç­–
âœ¨ **æ›´æœ‰æ·±åº¦** - é­‚å°æ•ˆæœç³»ç»Ÿæä¾›ä¸°å¯Œçš„ç»„åˆ
âœ¨ **æ›´æœ‰è¶£å‘³** - åŠ¨ç”»å’Œåé¦ˆå¢å¼ºæ¸¸æˆä½“éªŒ
âœ¨ **æ¶æ„æ›´æ¸…æ™°** - çŠ¶æ€æœºå’Œæ¨¡å—åŒ–è®¾è®¡æ˜“äºç»´æŠ¤

åŒæ—¶ä¿ç•™äº†åŸæœ‰ç³»ç»Ÿçš„ä¼˜ç‚¹ï¼Œä¸ä¼šè®©æ¸¸æˆå˜å¾—è¿‡äºå¤æ‚ã€‚

---

**ä¸‹ä¸€æ­¥è¡ŒåŠ¨**ï¼š
1. å®¡æŸ¥æœ¬æ–¹æ¡ˆå¹¶ç¡®è®¤æ”¹è¿›æ–¹å‘
2. å¼€å§‹å®ç°ç¬¬ä¸€é˜¶æ®µï¼šæ ¸å¿ƒæ¶æ„é‡æ„
3. é€æ­¥è¿­ä»£ï¼Œæµ‹è¯•å’Œä¼˜åŒ–

**é¢„è®¡æ€»å¼€å‘æ—¶é—´**ï¼š12-15 å°æ—¶
**é¢„è®¡å®Œæˆæ—¥æœŸ**ï¼šæ ¹æ®å¼€å‘èŠ‚å¥è°ƒæ•´
